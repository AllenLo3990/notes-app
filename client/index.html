<!doctype html>
<html lang="en" ng-app="application">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Foundation for Apps</title>
  <link href="/assets/css/app.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="/assets/js/foundation.js"></script>
  <script src="/assets/js/templates.js"></script>
  <script src="/assets/js/routes.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

  <script>
  // problems right now:
  // fix the editable div

  $(document).ready( function(){
    var noteID = 0;
    var menuHeight = document.getElementById('menu').offsetHeight;

    $("#addNote").click(function(){
      $("#removeAll").data("cancel",true);
      $("#addNote").hide();
      $("#canvas").prepend("<h1 id='add-to-canvas'>Add your note to the blank space. </h1>");
      $("#canvas").on("click",function(e){
        var newTop = e.pageY-menuHeight;
        var newLeft = e.pageX;
        if (newTop+140 >= $(window).height()-menuHeight){
          newTop = $(window).height()-menuHeight-200;
        }
        if (newLeft+140 >= $(window).width()){
          newLeft = $(window).width()-200;
        }
        $("#add-to-canvas").after("<div class='note' style='top:"+newTop+"px; left:"+newLeft+"px;' id='"+noteID+"'></div>");
        $("#"+noteID).draggable({
          containment: "#canvas",
          scroll: false,
          opacity: 0.7
        });
        // .resizable({
        //   containment: "#canvas",
        //   minWidth: 200,
        //   minHeight: 200
        // });
        $("#"+noteID).click(function(){
            if ( $(this).is('.ui-draggable-dragging') ) {
                return;
            }
            $(this).draggable( "option", "disabled", true );
            $(this).attr('contenteditable','true');
        })
        .blur(function(){
            $(this).draggable( 'option', 'disabled', false);
            $(this).attr('contenteditable','false');
        });
        noteID++;
        $("#canvas").off("click");
        $("#add-to-canvas").remove();
        $("#addNote").show();
        $("#removeAll").data("cancel",false);
      });
    });

    $("#removeAll").click(function(){
      if (!($("#removeAll").data("cancel"))) {
        $(".note").remove();
        noteID = 0;
      }else{
        $("#canvas").off("click");
        $("#add-to-canvas").remove();
        $("#addNote").show();
        $("#removeAll").data("cancel",false);
      }
    });
  });

  </script>

  <style>
  .note {
    width: 200px;
    height: 200px;
    position: absolute;
    background-color: orange;
    /*border-radius: 100px;*/
    text-align: justify;
    overflow: auto;
    /*outline: none;*/
    padding: 10px;
    white-space: pre-wrap; /*CSS3*/
    white-space: -moz-pre-wrap; /* Firefox */
    white-space: -pre-wrap;     /* Opera <7 */
    white-space: -o-pre-wrap;   /* Opera 7 */
    word-wrap: break-word;      /* IE */
  }

  .note::-webkit-scrollbar{width:0;}

  </style>

</head>
<body>
  <div class="grid-frame vertical">
    <div class="grid-content shrink collapse" id="menu">
      <div class="menu-group primary">
        <div class="menu-group-left">
          <ul class="primary menu-bar">
            <li><a><strong>Foundation for Apps</strong></a></li>
            <li><a id="addNote"><strong>+</strong></a></li>
          </ul>
        </div>
        <div class="menu-group-right">
          <ul class="primary menu-bar">
            <li><a id="removeAll"><strong>x</strong></a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="grid-block" id="canvas">
    </div>
  </div>
</body>
</html>
